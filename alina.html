<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invitation</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>
    <script src="confetti.js"></script>
  </head>
  <body>
    <div class="card-container">
      <div class="card">
        <div class="face front">
          <div class="front-content">
            <div class="hello">
              <div class="emitter"></div>
              <h1>Приглашение</h1>
              <h4>Суббота, 26 Июля</h4>
            </div>
          </div>
        </div>
        <div class="face back">
          <div class="back-content">
            <div>
              <h1>Back</h1>
            </div>
          </div>
        </div>
      </div>
    </div>
    <canvas
      id="canvas"
      style="filter: blur(10px); position: absolute; z-index: -1"
    ></canvas>
    <script>
      const colors = [
        "#f79533",
        "#f37055",
        "#ef4e5e",
        "#a166ab",
        "#5073b8",
        "#1098ad",
        "#07b39b",
        "#6fba82",
      ];
      const animations = [realistic, stars, pride, emoji];
      var opened = false;

      const card = document.querySelector(".card");
      card.addEventListener("click", () => {
        card.classList.toggle("flipped");
        if (!opened) {
          requestAnimFrame(loop);
          getRandomItem(animations)();
        }
        opened = true;
      });

      window.requestAnimFrame = (function () {
        return (
          window.requestAnimationFrame ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame ||
          window.oRequestAnimationFrame ||
          window.msRequestAnimationFrame ||
          function (callback) {
            window.setTimeout(callback, 1000 / 60);
          }
        );
      })();

      var canvas = document.getElementById("canvas"),
        w = window.innerWidth,
        h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
      //c = canvas.getContext('2d'),
      particles = [];
      tick = 0;
      var x = 0;
      function loop() {
        createParticles();
        updateParticles();
        killParticles();
        drawParticles();
        requestAnimFrame(loop);
      }

      function getRandomFloat(min, max) {
        return Math.random() * (max - min) + min;
      }

      function getRandomItem(arr) {
        const randomIndex = Math.floor(Math.random() * arr.length);
        return arr[randomIndex];
      }

      const hex2rgb = (hex) => {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);

        // return {r, g, b}
        return { r, g, b };
      };

      function createParticles() {
        var randVal1 = getRandomFloat(200, 255),
          randVal2 = getRandomFloat(200, 255),
          randVal3 = getRandomFloat(200, 255);

        var color = hex2rgb(getRandomItem(colors));

        //every 10th tick
        if (tick % 10 == 0) {
          //add particle if < 100
          if (particles.length < 100) {
            particles.push({
              x: Math.random() * canvas.width, //0 and width
              y: 0,
              speed: 2 + Math.random() * 3, //2-5
              radius: 5 + Math.random() * 5, //5-10
              color:
                "rgb(" +
                color["r"] +
                "," +
                color["g"] +
                "," +
                color["b"] +
                ")" /*'white'*/,
            });
          }
        }
      }

      function updateParticles() {
        for (var i in particles) {
          var part = particles[i];
          part.y += part.speed;
        }
      }

      function killParticles() {
        for (var i in particles) {
          var part = particles[i];

          if (part.y > canvas.height) {
            //console.log('x');
            part.y = 0;
          }
        }
      }

      function drawParticles() {
        var c = canvas.getContext("2d");
        c.fillStyle = "black";
        c.fillRect(0, 0, canvas.width, canvas.height);
        for (var i in particles) {
          var part = particles[i];
          c.beginPath();
          c.arc(part.x, part.y, part.radius, 0, Math.PI * 2);
          c.closePath();
          c.fillStyle = part.color;
          c.fill();
        }
      }
    </script>
  </body>
</html>
